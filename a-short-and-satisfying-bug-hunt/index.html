<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>learnbyexample - A short and satisfying bug hunt</title>

      
        <link rel="alternate" type="application/atom+xml" title="RSS" href="https://learnbyexample.github.io/atom.xml">
      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;learnbyexample.github.io&#x2F;site.css">
          
      

      
      
<link rel="icon" href="https://learnbyexample.github.io/favicon.svg">
<link rel="shortcut icon" href="https://learnbyexample.github.io/favicon.png">
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">learnbyexample</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;learnbyexample.github.io">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;learnbyexample.github.io&#x2F;books">
                            Books
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;learnbyexample.github.io&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;learnbyexample.github.io&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;learnbyexample.github.io">learnbyexample</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;learnbyexample.github.io">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;learnbyexample.github.io&#x2F;books">
                                    Books
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;learnbyexample.github.io&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;learnbyexample.github.io&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    


<div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content always-active">
        <nav id="TableOfContents">
            <ul>
                
                <li>
                    <a href="https://learnbyexample.github.io/a-short-and-satisfying-bug-hunt/#the-surprise" class="toc-link">The surprise</a>
                    
                </li>
                
                <li>
                    <a href="https://learnbyexample.github.io/a-short-and-satisfying-bug-hunt/#creating-minimal-failing-case" class="toc-link">Creating minimal failing case</a>
                    
                </li>
                
                <li>
                    <a href="https://learnbyexample.github.io/a-short-and-satisfying-bug-hunt/#tl-dr" class="toc-link">TL;DR</a>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</div>


<article class="post">
    
    <header class="post__header">
        <h1 class="post__title">
            <a href="https:&#x2F;&#x2F;learnbyexample.github.io&#x2F;a-short-and-satisfying-bug-hunt&#x2F;">A short and satisfying bug hunt</a>
        </h1>
        <div class="post__meta">
            <span class="post__time">2019-03-06</span>
            
        </div>
    </header>

    <div class="post-content">
      <h2 id="the-surprise">The surprise<a class="zola-anchor" href="#the-surprise" aria-label="Anchor link for: the-surprise">ðŸ”—</a></h2>
<p>So, a pleasant surprise awaited me last Sunday. As is my usual habit, I opened my
<a href="https://github.com/learnbyexample">github</a> account after breakfast to see if I've
got any sudden spurt in traffic. And as usual, things were normal. Except for the blue
notification, which was rare. I hoped it wasn't a silly pull request and thankfully
it was a <a href="https://github.com/learnbyexample/Command-line-text-processing/issues/24">new issue</a>
that was opened.</p>
<span id="continue-reading"></span>
<p>I gave the issue a cursory glance and wrongly guessed it was probably some line ending issue
(user was on Windows OS). As someone who has seen plenty of
bugs in previous job, I wasn't ruling out anything though. I first cloned the repo so as to try
to recreate the working environment without possible interference from my local working copy.
As the user had provided detailed information while opening the issue, I was able to quickly
replicate it. Sure enough, I was seeing the same problem. I only wondered why it wasn't
brought to my attention before. Either past users chose not to or things weren't interesting
enough to reach that far in the exercises.</p>
<h2 id="creating-minimal-failing-case">Creating minimal failing case<a class="zola-anchor" href="#creating-minimal-failing-case" aria-label="Anchor link for: creating-minimal-failing-case">ðŸ”—</a></h2>
<p>As I had written the <a href="https://github.com/learnbyexample/Command-line-text-processing/blob/master/exercises/GNU_grep/solve">solution checker script</a>
about 2 years back, the script looked alien.
Right from cloning the repo, I had to fight the urge to improve things. By the time I spotted
the issue, all such fantasies were thrown out. Replaced by a todo note to <em>someday</em> write automated
testing script to check that my script is indeed working properly for all the exercises.</p>
<p>To put it simply, the role of <code>solve</code> script is to check if the previous command
executed by the user solves the current exercise question. To do so, the script
gets the previous command from history and compares the output of that command
and a reference solution present in the exercise directory. Sounds simple right?
Yeah, I thought so too. I do remember testing few cases before I first published it
and no one had submitted an issue so far. So, why was it failing now?</p>
<p>As mentioned before, I thought it could be some weird line ending issue. But that was
effectively ruled out as it was failing for me as well on Linux. Still, I did check
for funny characters with <code>cat -A</code>. Nope, no issues there.</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#5597d6;">$</span><span style="color:#1f1f1f;"> grep</span><span style="color:#5597d6;"> -o </span><span style="color:#d07711;">&#39;^[^=]*&#39;</span><span style="color:#1f1f1f;"> sample.txt
</span><span style="color:#5597d6;">a[2]
foo_bar
appx_pi
greeting
food[4]
b[0][1]
$</span><span style="color:#1f1f1f;"> source ../solve</span><span style="color:#5597d6;"> -s
---------------------------------------------
Mismatch</span><span style="color:#1f1f1f;"> for question 1:
</span><span style="color:#5597d6;">Expected</span><span style="color:#1f1f1f;"> output is:
</span><span style="color:#5597d6;">a[2]
foo_bar
appx_pi
greeting
food[4]
b[0][1]
---------------------------------------------
</span></code></pre>
<p>Expected output was same as output for submitted solution. So, why is the script failing?
I remember passing the script through <a href="https://www.shellcheck.net/">shellcheck</a> but still
checked it again. No progress. So, then I started by trying to debug the most likely
culprit from terminal before trying to debug the whole script. Luckily, that turned out well.</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#5597d6;">$</span><span style="color:#1f1f1f;"> cat sample.txt 
</span><span style="color:#5597d6;">a[</span><span style="color:#b3933a;">2</span><span style="color:#5597d6;">]</span><span style="color:#72ab00;">=</span><span style="color:#d07711;">&#39;sample string&#39;
</span><span style="color:#5597d6;">foo_bar</span><span style="color:#72ab00;">=</span><span style="color:#d07711;">4232
</span><span style="color:#5597d6;">appx_pi</span><span style="color:#72ab00;">=</span><span style="color:#d07711;">3.14
</span><span style="color:#5597d6;">greeting</span><span style="color:#72ab00;">=</span><span style="color:#d07711;">&quot;Hi  there		have a nice   day&quot;
</span><span style="color:#5597d6;">food[</span><span style="color:#b3933a;">4</span><span style="color:#5597d6;">]</span><span style="color:#72ab00;">=</span><span style="color:#d07711;">&quot;dosa&quot;
</span><span style="color:#5597d6;">b[</span><span style="color:#b3933a;">0</span><span style="color:#5597d6;">][</span><span style="color:#b3933a;">1</span><span style="color:#5597d6;">]</span><span style="color:#72ab00;">=</span><span style="color:#d07711;">42

</span><span style="color:#5597d6;">$ </span><span style="color:#7f8989;"># say what??
</span><span style="color:#5597d6;">$ </span><span style="color:#72ab00;">[</span><span style="color:#1f1f1f;">[ $(</span><span style="color:#b39f04;">eval </span><span style="color:#d07711;">&quot;command grep -o &#39;^[^=]*&#39; sample.txt&quot;</span><span style="color:#1f1f1f;">) == \
&gt;    $(</span><span style="color:#b39f04;">eval </span><span style="color:#d07711;">&quot;command grep -o &#39;^[^=]*&#39; sample.txt&quot;</span><span style="color:#1f1f1f;">) </span><span style="color:#72ab00;">]</span><span style="color:#1f1f1f;">] </span><span style="color:#72ab00;">|| </span><span style="color:#b39f04;">echo </span><span style="color:#d07711;">&#39;Not fine&#39;
</span><span style="color:#5597d6;">Not</span><span style="color:#1f1f1f;"> fine

</span><span style="color:#5597d6;">$ </span><span style="color:#7f8989;"># after some attempts, I tried a command that won&#39;t have
</span><span style="color:#5597d6;">$ </span><span style="color:#7f8989;"># any [] characters in the output
</span><span style="color:#5597d6;">$ </span><span style="color:#7f8989;"># Eureka!
</span><span style="color:#5597d6;">$</span><span style="color:#1f1f1f;"> [[ $(</span><span style="color:#b39f04;">eval </span><span style="color:#d07711;">&quot;command grep &#39;bar&#39; sample.txt&quot;</span><span style="color:#1f1f1f;">) == \
</span><span style="color:#72ab00;">&gt;    </span><span style="color:#1f1f1f;">$(</span><span style="color:#b39f04;">eval </span><span style="color:#d07711;">&quot;command grep &#39;bar&#39; sample.txt&quot;</span><span style="color:#1f1f1f;">) ]] </span><span style="color:#72ab00;">|| </span><span style="color:#b39f04;">echo </span><span style="color:#d07711;">&#39;Not fine&#39;
</span><span style="color:#5597d6;">$ </span><span style="color:#72ab00;">[</span><span style="color:#1f1f1f;">[ foo == foo </span><span style="color:#72ab00;">]</span><span style="color:#1f1f1f;">] </span><span style="color:#72ab00;">&amp;&amp; </span><span style="color:#b39f04;">echo </span><span style="color:#d07711;">&#39;fine&#39;
</span><span style="color:#5597d6;">fine
$ </span><span style="color:#72ab00;">[</span><span style="color:#1f1f1f;">[ </span><span style="color:#d07711;">&#39;a[5]&#39;</span><span style="color:#1f1f1f;"> == a[5</span><span style="color:#72ab00;">]</span><span style="color:#1f1f1f;"> ]] </span><span style="color:#72ab00;">|| </span><span style="color:#b39f04;">echo </span><span style="color:#d07711;">&#39;Not fine&#39;
</span><span style="color:#5597d6;">Not</span><span style="color:#1f1f1f;"> fine
</span><span style="color:#5597d6;">$ </span><span style="color:#72ab00;">[</span><span style="color:#1f1f1f;">[ </span><span style="color:#d07711;">&#39;a[5]&#39;</span><span style="color:#1f1f1f;"> == </span><span style="color:#d07711;">&#39;a[5]&#39; </span><span style="color:#72ab00;">]</span><span style="color:#1f1f1f;">] </span><span style="color:#72ab00;">&amp;&amp; </span><span style="color:#b39f04;">echo </span><span style="color:#d07711;">&#39;fine&#39;
</span><span style="color:#5597d6;">fine
</span></code></pre>
<p>Having a minimal failing case from terminal was a relief. I tried <code>set -x</code> but
that didn't light a bulb either. Finally, somehow I thought perhaps characters
in the output was causing the issue and when <code>[]</code> characters were not present,
the comparison worked as expected.</p>
<p>I did think quoting could be the issue, but dismissed it at first as both sides
of comparison had the same command. Then my recent experience from reviewing
<a href="https://www.packtpub.com/application-development/command-line-fundamentals">Command Line Fundamentals</a>
book came in handy. I remembered that if quotes aren't used on RHS of comparison
operator, it is treated as <code>glob</code> matching instead of string matching. Phew.</p>
<h2 id="tl-dr">TL;DR<a class="zola-anchor" href="#tl-dr" aria-label="Anchor link for: tl-dr">ðŸ”—</a></h2>
<p>Always <a href="https://unix.stackexchange.com/questions/131766/why-does-my-shell-script-choke-on-whitespace-or-other-special-characters">quote strings in bash</a>
unless you have a very good reason for not using them.</p>
<p>After adding double quotes around the command substitution commands, the script
worked as expected. I thanked the user for opening the issue. And then informed
the author for cli fundamentals book as well.</p>

    </div>

    
    

    <div class="post-footer">
        
            
                <div class="post-tags">
                    
                        <a href="https:&#x2F;&#x2F;learnbyexample.github.io&#x2F;tags&#x2F;shell-scripting&#x2F;">#shell scripting</a>
                    
                        <a href="https:&#x2F;&#x2F;learnbyexample.github.io&#x2F;tags&#x2F;debugging&#x2F;">#debugging</a>
                    
                        <a href="https:&#x2F;&#x2F;learnbyexample.github.io&#x2F;tags&#x2F;corner-case&#x2F;">#corner case</a>
                    
                </div>
            
            
                <div class="post-nav">
                    
                    
                        <a class="next" href="https:&#x2F;&#x2F;learnbyexample.github.io&#x2F;python-for-maths&#x2F;">Python for maths â€º</a>
                    
                    
                    
                </div>
            

        

    </div>

    
    
</article>


                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;learnbyexample.github.io&#x2F;even.js" ></script>
      
    </body>

</html>
